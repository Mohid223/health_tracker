{% extends "base.html" %}

{% block title %}Disease Prediction - Health World {% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1 class="display-5">Disease Prediction</h1>
        <p class="lead">Assess your risk of developing lifestyle diseases</p>
    </div>
</div>

{% if not show_result %}
<!-- Prediction Form -->
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-brain me-2"></i>Enter Your Health Information</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('prediction') }}">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="age" class="form-label">Age</label>
                            <input type="number" class="form-control" id="age" name="age" min="1" max="120" required 
                                   value="{{ latest_vitals.user.age if latest_vitals and latest_vitals.user.age else '' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="bmi" class="form-label">BMI</label>
                            <input type="number" class="form-control" id="bmi" name="bmi" step="0.1" required 
                                   value="{{ "%.1f"|format(latest_vitals.bmi) if latest_vitals else '' }}">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="bp_systolic" class="form-label">Blood Pressure (Systolic)</label>
                            <input type="number" class="form-control" id="bp_systolic" name="bp_systolic" required 
                                   value="{{ latest_vitals.bp_systolic if latest_vitals else '' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="bp_diastolic" class="form-label">Blood Pressure (Diastolic)</label>
                            <input type="number" class="form-control" id="bp_diastolic" name="bp_diastolic" required 
                                   value="{{ latest_vitals.bp_diastolic if latest_vitals else '' }}">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="glucose" class="form-label">Glucose Level (mg/dL)</label>
                        <input type="number" class="form-control" id="glucose" name="glucose" step="0.1" required 
                               value="{{ "%.1f"|format(latest_vitals.glucose) if latest_vitals else '' }}">
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-info btn-lg">Calculate Risk</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Information Section -->
        <div class="card mt-4">
            <div class="card-body">
                <h5>How It Works</h5>
                <p>Our prediction model analyzes your health parameters using machine learning to estimate your risk of developing lifestyle diseases such as:</p>
                <ul>
                    <li>Diabetes</li>
                    <li>Hypertension</li>
                    <li>Cardiovascular diseases</li>
                    <li>Metabolic syndrome</li>
                </ul>
                <p class="text-muted"><small>Note: This is a predictive tool and not a medical diagnosis. Always consult healthcare professionals for medical advice.</small></p>
            </div>
        </div>
    </div>
</div>
{% else %}
<!-- Prediction Result -->
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header 
                {% if prediction == 'Low Risk' %}bg-success
                {% elif prediction == 'Medium Risk' %}bg-warning
                {% else %}bg-danger{% endif %} text-white">
                <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Prediction Result</h5>
            </div>
            <div class="card-body text-center">
                <div class="mb-4">
                    <i class="fas 
                        {% if prediction == 'Low Risk' %}fa-smile text-success
                        {% elif prediction == 'Medium Risk' %}fa-meh text-warning
                        {% else %}fa-frown text-danger{% endif %} fa-5x mb-3"></i>
                    <h3 class="card-title">{{ prediction }}</h3>
                    <p class="lead">{{ description }}</p>
                    <div class="progress mb-3" style="height: 25px;">
                        <div class="progress-bar 
                            {% if prediction == 'Low Risk' %}bg-success
                            {% elif prediction == 'Medium Risk' %}bg-warning
                            {% else %}bg-danger{% endif %}" 
                            style="width: {{ probability }}%">
                            {{ "%.1f"|format(probability) }}% Confidence
                        </div>
                    </div>
                </div>
                
                <div class="row text-start">
                    <div class="col-md-6">
                        <h5>Recommendations:</h5>
                        <ul>
                            {% if prediction == 'Low Risk' %}
                            <li>Continue maintaining healthy lifestyle habits</li>
                            <li>Regular exercise and balanced nutrition</li>
                            <li>Annual health check-ups</li>
                            {% elif prediction == 'Medium Risk' %}
                            <li>Improve dietary habits</li>
                            <li>Increase physical activity</li>
                            <li>Monitor blood pressure regularly</li>
                            <li>Consider consulting a nutritionist</li>
                            {% else %}
                            <li>Consult with a healthcare professional</li>
                            <li>Implement significant lifestyle changes</li>
                            <li>Regular monitoring of vital signs</li>
                            <li>Consider medical intervention if advised</li>
                            {% endif %}
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h5>Next Steps:</h5>
                        <ul>
                            <li>Track your vitals regularly</li>
                            <li>Set health goals in the dashboard</li>
                            <li>Schedule appointments with healthcare providers</li>
                            <li>Join health improvement programs if available</li>
                        </ul>
                    </div>
                </div>
                
                <div class="mt-4">
                    <a href="{{ url_for('prediction') }}" class="btn btn-primary me-2">New Prediction</a>
                    <a href="{{ url_for('vitals') }}" class="btn btn-outline-primary">Record Vitals</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}