 {% extends "base.html" %}

{% block title %}AI Health Assistant - Health Tracker{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <div class="card chat-card">
                <div class="card-header bg-gradient-primary text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <div class="chatbot-avatar me-3">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div>
                                <h4 class="mb-0">AI Health Assistant</h4>
                                <small class="opacity-75">Your personal health advisor</small>
                            </div>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="fas fa-cog"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" id="clear-btn"><i class="fas fa-trash me-2"></i>Clear Chat</a></li>
                                <li><a class="dropdown-item" href="#" id="export-btn"><i class="fas fa-download me-2"></i>Export Chat</a></li>
                                <li><a class="dropdown-item" href="#" id="suggestions-btn"><i class="fas fa-lightbulb me-2"></i>Show Suggestions</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="card-body p-0">
                    <!-- Quick Action Buttons -->
                    <div class="quick-actions p-3 border-bottom">
                        <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-outline-primary btn-sm action-btn" data-action="symptoms">
                                <i class="fas fa-stethoscope me-1"></i> Symptoms Analysis
                            </button>
                            <button class="btn btn-outline-success btn-sm action-btn" data-action="medication">
                                <i class="fas fa-pills me-1"></i> Medication Advice
                            </button>
                            <button class="btn btn-outline-info btn-sm action-btn" data-action="diet">
                                <i class="fas fa-apple-alt me-1"></i> Diet Plans
                            </button>
                            <button class="btn btn-outline-warning btn-sm action-btn" data-action="exercise">
                                <i class="fas fa-running me-1"></i> Exercise Tips
                            </button>
                            <button class="btn btn-outline-danger btn-sm action-btn" data-action="emergency">
                                <i class="fas fa-ambulance me-1"></i> Emergency Help
                            </button>
                        </div>
                    </div>

                    <!-- Chat Messages Container -->
                    <div id="chat-container" class="chat-messages">
                        <div class="welcome-message text-center" id="welcome-message">
                            <div class="chatbot-avatar-large mb-3">
                                <i class="fas fa-robot"></i>
                            </div>
                            <h5>Hello! I'm Your AI Health Assistant</h5>
                            <p class="text-muted">I can help you with symptoms analysis, medication advice, diet plans, exercise recommendations, and general health guidance.</p>
                            <div class="quick-starters mt-4">
                                <div class="row g-2">
                                    <div class="col-6">
                                        <button class="btn btn-light w-100 quick-starter" data-question="I have fever and headache, what should I do?">
                                            <i class="fas fa-thermometer-half me-1"></i> Fever & Headache
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button class="btn btn-light w-100 quick-starter" data-question="What are the best exercises for heart health?">
                                            <i class="fas fa-heart me-1"></i> Heart Health
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button class="btn btn-light w-100 quick-starter" data-question="How to manage diabetes through diet?">
                                            <i class="fas fa-syringe me-1"></i> Diabetes Diet
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button class="btn btn-light w-100 quick-starter" data-question="What are normal blood pressure readings?">
                                            <i class="fas fa-tachometer-alt me-1"></i> Blood Pressure
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Typing Indicator -->
                    <div id="typing-indicator" class="typing-indicator d-none">
                        <div class="d-flex align-items-center px-3 py-2">
                            <div class="typing-dots">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                            <small class="text-muted ms-2">AI Health Assistant is analyzing your query...</small>
                        </div>
                    </div>

                    <!-- Message Input Area -->
                    <div class="message-input-area p-3 border-top">
                        <div class="input-group">
                            <button class="btn btn-outline-secondary" type="button" id="attach-btn">
                                <i class="fas fa-paperclip"></i>
                            </button>
                            <input type="text" id="message-input" class="form-control" 
                                   placeholder="Describe your symptoms or ask a health question..." 
                                   autocomplete="off">
                            <button class="btn btn-outline-secondary" type="button" id="voice-btn">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <button id="send-btn" class="btn btn-primary">
                                <span id="send-text">Send</span>
                                <span id="loading-spinner" class="spinner-border spinner-border-sm d-none"></span>
                            </button>
                        </div>
                        
                        <!-- Quick Suggestions -->
                        <div class="quick-suggestions mt-2">
                            <div class="d-flex flex-wrap gap-1">
                                <button class="btn btn-outline-secondary btn-sm quick-suggestion" data-question="What should I do for fever?">
                                    <i class="fas fa-thermometer-full me-1"></i> Fever
                                </button>
                                <button class="btn btn-outline-secondary btn-sm quick-suggestion" data-question="How to lower blood pressure naturally?">
                                    <i class="fas fa-tachometer-alt me-1"></i> BP Control
                                </button>
                                <button class="btn btn-outline-secondary btn-sm quick-suggestion" data-question="Best foods for weight loss">
                                    <i class="fas fa-weight me-1"></i> Weight Loss
                                </button>
                                <button class="btn btn-outline-secondary btn-sm quick-suggestion" data-question="Home remedies for cough and cold">
                                    <i class="fas fa-lungs me-1"></i> Cold & Cough
                                </button>
                                <button class="btn btn-outline-secondary btn-sm quick-suggestion" data-question="How much water should I drink daily?">
                                    <i class="fas fa-tint me-1"></i> Hydration
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Emergency Modal -->
<div class="modal fade" id="emergencyModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title"><i class="fas fa-ambulance me-2"></i>Emergency Assistance</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-danger">
                    <strong><i class="fas fa-exclamation-triangle me-2"></i>Emergency Alert!</strong>
                    <p class="mb-0 mt-2">If you're experiencing severe symptoms like chest pain, difficulty breathing, or severe bleeding, please seek immediate medical attention.</p>
                </div>
                <div class="emergency-contacts">
                    <button class="btn btn-outline-danger w-100 mb-2" onclick="callEmergency('102')">
                        <i class="fas fa-ambulance me-2"></i>Call Ambulance (102)
                    </button>
                    <button class="btn btn-outline-danger w-100 mb-2" onclick="callEmergency('108')">
                        <i class="fas fa-phone-alt me-2"></i>Emergency Helpline (108)
                    </button>
                    <a href="{{ url_for('emergency') }}" class="btn btn-outline-primary w-100">
                        <i class="fas fa-map-marker-alt me-2"></i>Find Nearby Hospitals
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
class AdvancedHealthChatbot {
    constructor() {
        this.initializeElements();
        this.setupEventListeners();
        this.loadChatHistory();
        this.setupVoiceRecognition();
    }

    initializeElements() {
        this.chatContainer = document.getElementById('chat-container');
        this.messageInput = document.getElementById('message-input');
        this.sendBtn = document.getElementById('send-btn');
        this.clearBtn = document.getElementById('clear-btn');
        this.exportBtn = document.getElementById('export-btn');
        this.suggestionsBtn = document.getElementById('suggestions-btn');
        this.voiceBtn = document.getElementById('voice-btn');
        this.attachBtn = document.getElementById('attach-btn');
        this.welcomeMessage = document.getElementById('welcome-message');
        this.typingIndicator = document.getElementById('typing-indicator');
        this.sendText = document.getElementById('send-text');
        this.loadingSpinner = document.getElementById('loading-spinner');
        
        this.recognition = null;
        this.isListening = false;
    }

    setupEventListeners() {
        // Message sending
        this.sendBtn.addEventListener('click', () => this.sendMessage());
        this.messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') this.sendMessage();
        });

        // Quick actions
        document.querySelectorAll('.action-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const action = e.target.closest('.action-btn').dataset.action;
                this.handleQuickAction(action);
            });
        });

        // Quick suggestions and starters
        document.querySelectorAll('.quick-suggestion, .quick-starter').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const question = e.target.closest('button').dataset.question;
                this.messageInput.value = question;
                this.sendMessage();
            });
        });

        // Control buttons
        this.clearBtn.addEventListener('click', () => this.clearChatHistory());
        this.exportBtn.addEventListener('click', () => this.exportChat());
        this.suggestionsBtn.addEventListener('click', () => this.toggleSuggestions());

        // Voice recognition
        this.voiceBtn.addEventListener('click', () => this.toggleVoiceRecognition());
    }

    setupVoiceRecognition() {
        if ('webkitSpeechRecognition' in window) {
            this.recognition = new webkitSpeechRecognition();
            this.recognition.continuous = false;
            this.recognition.interimResults = false;
            this.recognition.lang = 'en-US';

            this.recognition.onstart = () => {
                this.voiceBtn.innerHTML = '<i class="fas fa-stop"></i>';
                this.voiceBtn.classList.add('btn-danger');
                this.isListening = true;
            };

            this.recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                this.messageInput.value = transcript;
                this.toggleVoiceRecognition();
            };

            this.recognition.onerror = () => {
                this.toggleVoiceRecognition();
            };

            this.recognition.onend = () => {
                this.toggleVoiceRecognition();
            };
        } else {
            this.voiceBtn.style.display = 'none';
        }
    }

    toggleVoiceRecognition() {
        if (!this.recognition) return;

        if (this.isListening) {
            this.recognition.stop();
            this.voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
            this.voiceBtn.classList.remove('btn-danger');
            this.isListening = false;
        } else {
            this.recognition.start();
        }
    }

    handleQuickAction(action) {
        const actions = {
            symptoms: "I'm experiencing some health symptoms. Can you help me analyze them?",
            medication: "I need advice about medications and their proper usage.",
            diet: "Can you provide dietary recommendations for better health?",
            exercise: "What exercise routine would be beneficial for my health condition?",
            emergency: "I need emergency medical assistance immediately!"
        };

        if (action === 'emergency') {
            this.showEmergencyModal();
        } else {
            this.messageInput.value = actions[action];
            this.sendMessage();
        }
    }

    showEmergencyModal() {
        const modal = new bootstrap.Modal(document.getElementById('emergencyModal'));
        modal.show();
    }

    showTypingIndicator() {
        this.typingIndicator.classList.remove('d-none');
        this.scrollToBottom();
    }

    hideTypingIndicator() {
        this.typingIndicator.classList.add('d-none');
    }

    addMessageToChat(message, isUser, timestamp = null) {
        const timestampText = timestamp ? new Date(timestamp).toLocaleTimeString() : new Date().toLocaleTimeString();
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;

        const messageBubble = document.createElement('div');
        messageBubble.className = `message-bubble ${isUser ? 'user-bubble' : 'bot-bubble'}`;

        if (!isUser) {
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.innerHTML = '<i class="fas fa-robot"></i>';
            messageDiv.appendChild(avatar);
        }

        const messageContent = document.createElement('div');
        messageContent.className = 'message-content';

        const messageText = document.createElement('div');
        messageText.className = 'message-text';
        
        // Format the message with line breaks and proper formatting
        const formattedMessage = this.formatMessage(message);
        messageText.innerHTML = formattedMessage;

        const timestampElement = document.createElement('div');
        timestampElement.className = 'message-time';
        timestampElement.textContent = timestampText;

        messageContent.appendChild(messageText);
        messageContent.appendChild(timestampElement);
        messageBubble.appendChild(messageContent);
        messageDiv.appendChild(messageBubble);

        if (isUser) {
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.innerHTML = '<i class="fas fa-user"></i>';
            messageDiv.appendChild(avatar);
        }

        this.chatContainer.appendChild(messageDiv);
        this.welcomeMessage.style.display = 'none';
        this.scrollToBottom();
    }

    formatMessage(message) {
        // Convert line breaks to HTML
        let formatted = message.replace(/\n/g, '<br>');
        
        // Add basic formatting for lists and important points
        formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
        
        return formatted;
    }

    async sendMessage() {
        const message = this.messageInput.value.trim();
        if (!message) return;

        // Disable input and show loading
        this.setInputState(true);
        this.addMessageToChat(message, true);

        // Clear input
        this.messageInput.value = '';

        // Show typing indicator
        this.showTypingIndicator();

        try {
            // Simulate AI response - In real implementation, this would call your backend API
            const response = await this.generateAIResponse(message);
            this.hideTypingIndicator();
            this.addMessageToChat(response, false);

        } catch (error) {
            console.error('Error sending message:', error);
            this.hideTypingIndicator();
            this.addMessageToChat('I apologize, but I encountered an error while processing your request. Please try again or contact technical support if the issue persists.', false);
        } finally {
            this.setInputState(false);
        }
    }

    async generateAIResponse(userMessage) {
        // Simulate API delay
        await new Promise(resolve => setTimeout(resolve, 2000 + Math.random() * 1000));
        
        // Convert message to lowercase for easier matching
        const message = userMessage.toLowerCase();
        
        // Comprehensive health response system
        if (message.includes('fever') && message.includes('headache')) {
            return `Based on your symptoms of fever and headache, here's my assessment:

Common causes could include:
- Viral infections like flu or common cold
- Bacterial infections
- Dehydration
- Stress or tension

Recommended actions:
1. Rest adequately and maintain hydration
2. Monitor your temperature regularly
3. Consider over-the-counter fever reducers like paracetamol
4. Apply cool compresses to forehead
5. Maintain proper room ventilation

Seek immediate medical attention if:
- Fever exceeds 103°F (39.4°C)
- Headache becomes severe or persistent
- You experience neck stiffness or confusion
- Symptoms worsen after 48 hours

Please consult a healthcare professional for proper diagnosis and treatment.`;
        }
        else if (message.includes('blood pressure') || message.includes('bp')) {
            return `Understanding Blood Pressure Readings:

Normal blood pressure ranges:
- Optimal: Below 120/80 mmHg
- Elevated: 120-129/<80 mmHg
- Hypertension Stage 1: 130-139/80-89 mmHg
- Hypertension Stage 2: 140+/90+ mmHg

Lifestyle modifications for blood pressure management:
- Reduce sodium intake to less than 2,300mg daily
- Maintain healthy body weight
- Regular aerobic exercise (30 minutes daily)
- Limit alcohol consumption
- Manage stress through meditation or yoga
- Increase potassium-rich foods (bananas, leafy greens)

Monitoring recommendations:
- Check BP at consistent times daily
- Avoid caffeine and exercise 30 minutes before measurement
- Sit quietly for 5 minutes before reading
- Keep a BP log for your healthcare provider

Consult your doctor for personalized medication and monitoring plans.`;
        }
        else if (message.includes('diabetes') && message.includes('diet')) {
            return `Diabetes Management Through Diet:

Key dietary principles:
- Consistent carbohydrate intake throughout the day
- Focus on low glycemic index foods
- Balanced meals with protein, healthy fats, and fiber

Recommended foods:
- Non-starchy vegetables (broccoli, spinach, peppers)
- Whole grains (oats, quinoa, brown rice)
- Lean proteins (chicken, fish, tofu, legumes)
- Healthy fats (avocado, nuts, olive oil)
- Low-sugar fruits (berries, apples, citrus)

Foods to limit:
- Refined carbohydrates and sugars
- Processed foods and snacks
- Sugar-sweetened beverages
- High-fat meats and dairy

Sample meal plan:
Breakfast: Oatmeal with berries and nuts
Lunch: Grilled chicken salad with olive oil dressing
Snack: Apple with almond butter
Dinner: Baked salmon with quinoa and steamed vegetables

Always monitor blood glucose levels and consult with a dietitian for personalized meal planning.`;
        }
        else if (message.includes('exercise') || message.includes('workout')) {
            return `Comprehensive Exercise Guidelines:

For general health maintenance:
- 150 minutes of moderate aerobic activity weekly
- OR 75 minutes of vigorous aerobic activity weekly
- Strength training 2-3 times per week
- Flexibility exercises 2-3 times per week

Exercise recommendations by goal:

Weight Management:
- 300+ minutes moderate activity weekly
- Combination of cardio and strength training
- High-intensity interval training (HIIT)

Heart Health:
- Regular aerobic exercise (brisk walking, cycling)
- Resistance training for muscle strength
- Consistency over intensity

Stress Reduction:
- Yoga and tai chi
- Mindful walking or swimming
- Breathing exercises

Important precautions:
- Consult your doctor before starting new exercises
- Warm up properly before workouts
- Stay hydrated during exercise
- Listen to your body and rest when needed`;
        }
        else if (message.includes('medication') || message.includes('pill')) {
            return `Medication Safety Guidelines:

General medication principles:
- Always take medications as prescribed
- Never share prescriptions with others
- Store medications properly (cool, dry place)
- Keep updated medication list with you

Important safety tips:
1. Understand potential side effects
2. Know drug interactions with food/alcohol
3. Follow storage instructions carefully
4. Dispose of expired medications properly
5. Use pill organizers for multiple medications

When to contact your doctor:
- Experiencing severe side effects
- Missing multiple doses
- Considering stopping medication
- Planning to take new supplements

Emergency situations:
- Suspected overdose
- Severe allergic reactions
- Confusion about medication instructions

Always maintain open communication with your healthcare provider about all medications you're taking.`;
        }
        else if (message.includes('emergency') || message.includes('urgent')) {
            return `URGENT MEDICAL ATTENTION REQUIRED

Based on your message indicating an emergency situation:

IMMEDIATE ACTIONS:
1. Call emergency services (102 or 108) immediately
2. Do not attempt to drive yourself to the hospital
3. Stay on the line with emergency operators
4. Follow their instructions carefully

While waiting for help:
- Stay calm and keep the person comfortable
- Loosen any tight clothing
- Do not give anything to eat or drink
- Be prepared to provide medical history

This AI assistant cannot provide emergency medical care. Please seek immediate professional medical attention for any serious health concerns.

After stabilizing the situation, you can return for follow-up care guidance.`;
        }
        else {
            // General health advice for other queries
            return `Thank you for your health-related query. While I'm an AI assistant and cannot replace professional medical advice, I can provide general health information.

For your specific question about "${userMessage}", here are some general guidelines:

1. Always consult with healthcare professionals for personalized medical advice
2. Maintain regular health check-ups and screenings
3. Follow evidence-based health practices
4. Keep track of your symptoms and health metrics
5. Don't hesitate to seek emergency care for severe symptoms

Would you like me to provide more specific information about any particular aspect of health management, or would you prefer to consult with a healthcare provider for personalized advice?

Remember: Your health and safety are the top priority. When in doubt, always seek professional medical attention.`;
        }
    }

    setInputState(disabled) {
        this.messageInput.disabled = disabled;
        this.sendBtn.disabled = disabled;
        
        if (disabled) {
            this.sendText.classList.add('d-none');
            this.loadingSpinner.classList.remove('d-none');
        } else {
            this.sendText.classList.remove('d-none');
            this.loadingSpinner.classList.add('d-none');
            this.messageInput.focus();
        }
    }

    scrollToBottom() {
        this.chatContainer.scrollTop = this.chatContainer.scrollHeight;
    }

    async loadChatHistory() {
        try {
            // Simulate loading chat history
            const savedChat = localStorage.getItem('healthChatHistory');
            if (savedChat) {
                const messages = JSON.parse(savedChat);
                if (messages.length > 0) {
                    this.welcomeMessage.style.display = 'none';
                    messages.forEach(message => {
                        this.addMessageToChat(message.text, message.isUser, message.timestamp);
                    });
                }
            }
            this.scrollToBottom();
        } catch (error) {
            console.error('Failed to load chat history:', error);
        }
    }

    saveChatHistory() {
        const messages = [];
        document.querySelectorAll('.message').forEach(msg => {
            const text = msg.querySelector('.message-text').textContent;
            const isUser = msg.classList.contains('user-message');
            const timestamp = msg.querySelector('.message-time').textContent;
            messages.push({ text, isUser, timestamp });
        });
        localStorage.setItem('healthChatHistory', JSON.stringify(messages));
    }

    async clearChatHistory() {
        if (confirm('Are you sure you want to clear the chat history?')) {
            try {
                localStorage.removeItem('healthChatHistory');
                this.chatContainer.innerHTML = '';
                this.welcomeMessage.style.display = 'block';
                this.addMessageToChat("Chat history cleared. How can I assist you with your health concerns today?", false);
            } catch (error) {
                alert('Failed to clear chat history');
                console.error('Error clearing chat:', error);
            }
        }
    }

    exportChat() {
        const messages = this.chatContainer.querySelectorAll('.message-text');
        let chatText = "Health Assistant Conversation Record\n";
        chatText += "Generated on: " + new Date().toLocaleString() + "\n\n";
        
        messages.forEach((msg, index) => {
            const isUser = msg.closest('.user-message');
            chatText += `${isUser ? 'Patient' : 'Health Assistant'}: ${msg.textContent}\n\n`;
        });

        const blob = new Blob([chatText], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'health-conversation-record.txt';
        a.click();
        URL.revokeObjectURL(url);
    }

    toggleSuggestions() {
        const suggestions = document.querySelector('.quick-suggestions');
        suggestions.style.display = suggestions.style.display === 'none' ? 'block' : 'none';
    }
}

// Global emergency function
function callEmergency(number) {
    if (confirm(`Call emergency services at ${number}?`)) {
        window.location.href = `tel:${number}`;
    }
}

// Initialize chatbot when page loads
document.addEventListener('DOMContentLoaded', () => {
    const chatbot = new AdvancedHealthChatbot();
    
    // Save chat history when leaving page
    window.addEventListener('beforeunload', () => {
        chatbot.saveChatHistory();
    });
});
</script>

<style>
.chat-card {
    height: 80vh;
    display: flex;
    flex-direction: column;
}

.bg-gradient-primary {
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
}

.chatbot-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
}

.chatbot-avatar-large {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    color: white;
    font-size: 2rem;
}

.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    background: #f8f9fa;
}

.message {
    display: flex;
    align-items: flex-end;
    margin-bottom: 20px;
}

.user-message {
    justify-content: flex-end;
}

.bot-message {
    justify-content: flex-start;
}

.message-avatar {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    background: #e9ecef;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    color: #6c757d;
    flex-shrink: 0;
}

.user-message .message-avatar {
    background: #007bff;
    color: white;
    order: 2;
    margin-left: 10px;
}

.bot-message .message-avatar {
    margin-right: 10px;
}

.message-bubble {
    max-width: 70%;
    padding: 12px 16px;
    border-radius: 18px;
    position: relative;
}

.user-bubble {
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    color: white;
    border-bottom-right-radius: 4px;
}

.bot-bubble {
    background: white;
    color: #333;
    border: 1px solid #e9ecef;
    border-bottom-left-radius: 4px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.message-content {
    display: flex;
    flex-direction: column;
}

.message-text {
    line-height: 1.4;
    word-wrap: break-word;
}

.message-time {
    font-size: 0.75rem;
    opacity: 0.7;
    margin-top: 4px;
}

.user-bubble .message-time {
    color: rgba(255,255,255,0.8);
}

.bot-bubble .message-time {
    color: #6c757d;
}

.typing-indicator {
    background: white;
    border-top: 1px solid #e9ecef;
}

.typing-dots {
    display: flex;
    gap: 4px;
}

.typing-dots span {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #6c757d;
    animation: typing 1.4s infinite ease-in-out;
}

.typing-dots span:nth-child(1) { animation-delay: -0.32s; }
.typing-dots span:nth-child(2) { animation-delay: -0.16s; }

@keyframes typing {
    0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
    40% { transform: scale(1); opacity: 1; }
}

.quick-actions {
    background: white;
}

.quick-starters .btn {
    font-size: 0.8rem;
    padding: 8px 4px;
}

.message-input-area {
    background: white;
}

.quick-suggestions .btn {
    font-size: 0.75rem;
    padding: 4px 8px;
}

.chat-messages::-webkit-scrollbar {
    width: 6px;
}

.chat-messages::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.chat-messages::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

.chat-messages::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

.welcome-message {
    padding: 40px 20px;
}

.quick-starters {
    max-width: 400px;
    margin: 0 auto;
}

.action-btn {
    font-size: 0.8rem;
    padding: 6px 12px;
}

@media (max-width: 768px) {
    .chat-card {
        height: 90vh;
    }
    
    .message-bubble {
        max-width: 85%;
    }
    
    .quick-actions .btn {
        font-size: 0.7rem;
        padding: 4px 8px;
    }
}
</style>
{% endblock %}